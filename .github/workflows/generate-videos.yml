name: Auto-Generate & Upload Videos for All Zodiac Signs

on:
  schedule:
    - cron: '0 20 * * *'  # Runs daily at 6 AM AEDT (Australian Eastern Daylight Time) = 20:00 UTC previous day
  workflow_dispatch:
    inputs:
      auto_upload:
        description: 'Auto upload to YouTube?'
        required: false
        default: 'true'
        type: choice
        options:
          - 'true'
          - 'false'

permissions:
  contents: read

jobs:
  aries:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - run: sudo apt-get update && sudo apt-get install -y ffmpeg imagemagick && sudo sed -i '/<policy domain="path" rights="none" pattern="@\*"/d' /etc/ImageMagick-6/policy.xml
      - run: pip install -r requirements.txt
      - run: mkdir -p videos/youtube_shorts/ videos/instagram_reels/
      - run: echo "ðŸŒ Australian Date/Time:" && python -c "from datetime import datetime; import pytz; tz = pytz.timezone('Australia/Sydney'); print(datetime.now(tz).strftime('%A, %B %d, %Y at %I:%M %p %Z'))"
      - run: python generate_short.py --sign "Aries"
        env:
          HUGGINGFACE_API_KEY: ${{ secrets.HUGGINGFACE_API_KEY }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
      - run: python upload_youtube.py --sign "Aries" --shorts
        env:
          YOUTUBE_CLIENT_ID: ${{ secrets.YOUTUBE_CLIENT_ID }}
          YOUTUBE_CLIENT_SECRET: ${{ secrets.YOUTUBE_CLIENT_SECRET }}
          YOUTUBE_REFRESH_TOKEN: ${{ secrets.YOUTUBE_REFRESH_TOKEN }}
        if: env.YOUTUBE_CLIENT_ID != '' && github.event.inputs.auto_upload != 'false'
        continue-on-error: true
      - name: Upload YouTube Shorts artifact (backup)
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-backup-aries
          path: videos/youtube_shorts/Aries_*.mp4
          retention-days: 7
          if-no-files-found: warn
      
      - name: Upload Instagram Reels artifact
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-insta-aries
          path: videos/instagram_reels/Aries_*.mp4
          retention-days: 7
          if-no-files-found: warn

  taurus:
    needs: aries
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - run: sudo apt-get update && sudo apt-get install -y ffmpeg imagemagick && sudo sed -i '/<policy domain="path" rights="none" pattern="@\*"/d' /etc/ImageMagick-6/policy.xml
      - run: pip install -r requirements.txt
      - run: mkdir -p videos/youtube_shorts/ videos/instagram_reels/
      - run: python generate_short.py --sign "Taurus"
        env:
          HUGGINGFACE_API_KEY: ${{ secrets.HUGGINGFACE_API_KEY }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
      - run: sleep 90 && python upload_youtube.py --sign "Taurus" --shorts
        env:
          YOUTUBE_CLIENT_ID: ${{ secrets.YOUTUBE_CLIENT_ID }}
          YOUTUBE_CLIENT_SECRET: ${{ secrets.YOUTUBE_CLIENT_SECRET }}
          YOUTUBE_REFRESH_TOKEN: ${{ secrets.YOUTUBE_REFRESH_TOKEN }}
        if: env.YOUTUBE_CLIENT_ID != '' && github.event.inputs.auto_upload != 'false'
        continue-on-error: true
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-backup-taurus
          path: videos/youtube_shorts/Taurus_*.mp4
          retention-days: 7
          if-no-files-found: warn
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-insta-taurus
          path: videos/instagram_reels/Taurus_*.mp4
          retention-days: 7
          if-no-files-found: warn

  gemini:
    needs: taurus
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - run: sudo apt-get update && sudo apt-get install -y ffmpeg imagemagick && sudo sed -i '/<policy domain="path" rights="none" pattern="@\*"/d' /etc/ImageMagick-6/policy.xml
      - run: pip install -r requirements.txt
      - run: mkdir -p videos/youtube_shorts/ videos/instagram_reels/
      - run: python generate_short.py --sign "Gemini"
        env:
          HUGGINGFACE_API_KEY: ${{ secrets.HUGGINGFACE_API_KEY }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
      - run: sleep 90 && python upload_youtube.py --sign "Gemini" --shorts
        env:
          YOUTUBE_CLIENT_ID: ${{ secrets.YOUTUBE_CLIENT_ID }}
          YOUTUBE_CLIENT_SECRET: ${{ secrets.YOUTUBE_CLIENT_SECRET }}
          YOUTUBE_REFRESH_TOKEN: ${{ secrets.YOUTUBE_REFRESH_TOKEN }}
        if: env.YOUTUBE_CLIENT_ID != '' && github.event.inputs.auto_upload != 'false'
        continue-on-error: true
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-backup-gemini
          path: videos/youtube_shorts/Gemini_*.mp4
          retention-days: 7
          if-no-files-found: warn
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-insta-gemini
          path: videos/instagram_reels/Gemini_*.mp4
          retention-days: 7
          if-no-files-found: warn

  cancer:
    needs: gemini
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - run: sudo apt-get update && sudo apt-get install -y ffmpeg imagemagick && sudo sed -i '/<policy domain="path" rights="none" pattern="@\*"/d' /etc/ImageMagick-6/policy.xml
      - run: pip install -r requirements.txt
      - run: mkdir -p videos/youtube_shorts/ videos/instagram_reels/
      - run: python generate_short.py --sign "Cancer"
        env:
          HUGGINGFACE_API_KEY: ${{ secrets.HUGGINGFACE_API_KEY }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
      - run: sleep 90 && python upload_youtube.py --sign "Cancer" --shorts
        env:
          YOUTUBE_CLIENT_ID: ${{ secrets.YOUTUBE_CLIENT_ID }}
          YOUTUBE_CLIENT_SECRET: ${{ secrets.YOUTUBE_CLIENT_SECRET }}
          YOUTUBE_REFRESH_TOKEN: ${{ secrets.YOUTUBE_REFRESH_TOKEN }}
        if: env.YOUTUBE_CLIENT_ID != '' && github.event.inputs.auto_upload != 'false'
        continue-on-error: true
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-backup-cancer
          path: videos/youtube_shorts/Cancer_*.mp4
          retention-days: 7
          if-no-files-found: warn
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-insta-cancer
          path: videos/instagram_reels/Cancer_*.mp4
          retention-days: 7
          if-no-files-found: warn

  leo:
    needs: cancer
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - run: sudo apt-get update && sudo apt-get install -y ffmpeg imagemagick && sudo sed -i '/<policy domain="path" rights="none" pattern="@\*"/d' /etc/ImageMagick-6/policy.xml
      - run: pip install -r requirements.txt
      - run: mkdir -p videos/youtube_shorts/ videos/instagram_reels/
      - run: python generate_short.py --sign "Leo"
        env:
          HUGGINGFACE_API_KEY: ${{ secrets.HUGGINGFACE_API_KEY }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
      - run: sleep 90 && python upload_youtube.py --sign "Leo" --shorts
        env:
          YOUTUBE_CLIENT_ID: ${{ secrets.YOUTUBE_CLIENT_ID }}
          YOUTUBE_CLIENT_SECRET: ${{ secrets.YOUTUBE_CLIENT_SECRET }}
          YOUTUBE_REFRESH_TOKEN: ${{ secrets.YOUTUBE_REFRESH_TOKEN }}
        if: env.YOUTUBE_CLIENT_ID != '' && github.event.inputs.auto_upload != 'false'
        continue-on-error: true
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-backup-leo
          path: videos/youtube_shorts/Leo_*.mp4
          retention-days: 7
          if-no-files-found: warn
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-insta-leo
          path: videos/instagram_reels/Leo_*.mp4
          retention-days: 7
          if-no-files-found: warn

  virgo:
    needs: leo
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - run: sudo apt-get update && sudo apt-get install -y ffmpeg imagemagick && sudo sed -i '/<policy domain="path" rights="none" pattern="@\*"/d' /etc/ImageMagick-6/policy.xml
      - run: pip install -r requirements.txt
      - run: mkdir -p videos/youtube_shorts/ videos/instagram_reels/
      - run: python generate_short.py --sign "Virgo"
        env:
          HUGGINGFACE_API_KEY: ${{ secrets.HUGGINGFACE_API_KEY }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
      - run: sleep 90 && python upload_youtube.py --sign "Virgo" --shorts
        env:
          YOUTUBE_CLIENT_ID: ${{ secrets.YOUTUBE_CLIENT_ID }}
          YOUTUBE_CLIENT_SECRET: ${{ secrets.YOUTUBE_CLIENT_SECRET }}
          YOUTUBE_REFRESH_TOKEN: ${{ secrets.YOUTUBE_REFRESH_TOKEN }}
        if: env.YOUTUBE_CLIENT_ID != '' && github.event.inputs.auto_upload != 'false'
        continue-on-error: true
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-backup-virgo
          path: videos/youtube_shorts/Virgo_*.mp4
          retention-days: 7
          if-no-files-found: warn
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-insta-virgo
          path: videos/instagram_reels/Virgo_*.mp4
          retention-days: 7
          if-no-files-found: warn

  libra:
    needs: virgo
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - run: sudo apt-get update && sudo apt-get install -y ffmpeg imagemagick && sudo sed -i '/<policy domain="path" rights="none" pattern="@\*"/d' /etc/ImageMagick-6/policy.xml
      - run: pip install -r requirements.txt
      - run: mkdir -p videos/youtube_shorts/ videos/instagram_reels/
      - run: python generate_short.py --sign "Libra"
        env:
          HUGGINGFACE_API_KEY: ${{ secrets.HUGGINGFACE_API_KEY }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
      - run: sleep 90 && python upload_youtube.py --sign "Libra" --shorts
        env:
          YOUTUBE_CLIENT_ID: ${{ secrets.YOUTUBE_CLIENT_ID }}
          YOUTUBE_CLIENT_SECRET: ${{ secrets.YOUTUBE_CLIENT_SECRET }}
          YOUTUBE_REFRESH_TOKEN: ${{ secrets.YOUTUBE_REFRESH_TOKEN }}
        if: env.YOUTUBE_CLIENT_ID != '' && github.event.inputs.auto_upload != 'false'
        continue-on-error: true
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-backup-libra
          path: videos/youtube_shorts/Libra_*.mp4
          retention-days: 7
          if-no-files-found: warn
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-insta-libra
          path: videos/instagram_reels/Libra_*.mp4
          retention-days: 7
          if-no-files-found: warn

  scorpio:
    needs: libra
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - run: sudo apt-get update && sudo apt-get install -y ffmpeg imagemagick && sudo sed -i '/<policy domain="path" rights="none" pattern="@\*"/d' /etc/ImageMagick-6/policy.xml
      - run: pip install -r requirements.txt
      - run: mkdir -p videos/youtube_shorts/ videos/instagram_reels/
      - run: python generate_short.py --sign "Scorpio"
        env:
          HUGGINGFACE_API_KEY: ${{ secrets.HUGGINGFACE_API_KEY }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
      - run: sleep 90 && python upload_youtube.py --sign "Scorpio" --shorts
        env:
          YOUTUBE_CLIENT_ID: ${{ secrets.YOUTUBE_CLIENT_ID }}
          YOUTUBE_CLIENT_SECRET: ${{ secrets.YOUTUBE_CLIENT_SECRET }}
          YOUTUBE_REFRESH_TOKEN: ${{ secrets.YOUTUBE_REFRESH_TOKEN }}
        if: env.YOUTUBE_CLIENT_ID != '' && github.event.inputs.auto_upload != 'false'
        continue-on-error: true
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-backup-scorpio
          path: videos/youtube_shorts/Scorpio_*.mp4
          retention-days: 7
          if-no-files-found: warn
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-insta-scorpio
          path: videos/instagram_reels/Scorpio_*.mp4
          retention-days: 7
          if-no-files-found: warn

  sagittarius:
    needs: scorpio
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - run: sudo apt-get update && sudo apt-get install -y ffmpeg imagemagick && sudo sed -i '/<policy domain="path" rights="none" pattern="@\*"/d' /etc/ImageMagick-6/policy.xml
      - run: pip install -r requirements.txt
      - run: mkdir -p videos/youtube_shorts/ videos/instagram_reels/
      - run: python generate_short.py --sign "Sagittarius"
        env:
          HUGGINGFACE_API_KEY: ${{ secrets.HUGGINGFACE_API_KEY }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
      - run: sleep 90 && python upload_youtube.py --sign "Sagittarius" --shorts
        env:
          YOUTUBE_CLIENT_ID: ${{ secrets.YOUTUBE_CLIENT_ID }}
          YOUTUBE_CLIENT_SECRET: ${{ secrets.YOUTUBE_CLIENT_SECRET }}
          YOUTUBE_REFRESH_TOKEN: ${{ secrets.YOUTUBE_REFRESH_TOKEN }}
        if: env.YOUTUBE_CLIENT_ID != '' && github.event.inputs.auto_upload != 'false'
        continue-on-error: true
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-backup-sagittarius
          path: videos/youtube_shorts/Sagittarius_*.mp4
          retention-days: 7
          if-no-files-found: warn
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-insta-sagittarius
          path: videos/instagram_reels/Sagittarius_*.mp4
          retention-days: 7
          if-no-files-found: warn

  capricorn:
    needs: sagittarius
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - run: sudo apt-get update && sudo apt-get install -y ffmpeg imagemagick && sudo sed -i '/<policy domain="path" rights="none" pattern="@\*"/d' /etc/ImageMagick-6/policy.xml
      - run: pip install -r requirements.txt
      - run: mkdir -p videos/youtube_shorts/ videos/instagram_reels/
      - run: python generate_short.py --sign "Capricorn"
        env:
          HUGGINGFACE_API_KEY: ${{ secrets.HUGGINGFACE_API_KEY }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
      - run: sleep 90 && python upload_youtube.py --sign "Capricorn" --shorts
        env:
          YOUTUBE_CLIENT_ID: ${{ secrets.YOUTUBE_CLIENT_ID }}
          YOUTUBE_CLIENT_SECRET: ${{ secrets.YOUTUBE_CLIENT_SECRET }}
          YOUTUBE_REFRESH_TOKEN: ${{ secrets.YOUTUBE_REFRESH_TOKEN }}
        if: env.YOUTUBE_CLIENT_ID != '' && github.event.inputs.auto_upload != 'false'
        continue-on-error: true
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-backup-capricorn
          path: videos/youtube_shorts/Capricorn_*.mp4
          retention-days: 7
          if-no-files-found: warn
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-insta-capricorn
          path: videos/instagram_reels/Capricorn_*.mp4
          retention-days: 7
          if-no-files-found: warn

  aquarius:
    needs: capricorn
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - run: sudo apt-get update && sudo apt-get install -y ffmpeg imagemagick && sudo sed -i '/<policy domain="path" rights="none" pattern="@\*"/d' /etc/ImageMagick-6/policy.xml
      - run: pip install -r requirements.txt
      - run: mkdir -p videos/youtube_shorts/ videos/instagram_reels/
      - run: python generate_short.py --sign "Aquarius"
        env:
          HUGGINGFACE_API_KEY: ${{ secrets.HUGGINGFACE_API_KEY }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
      - run: sleep 90 && python upload_youtube.py --sign "Aquarius" --shorts
        env:
          YOUTUBE_CLIENT_ID: ${{ secrets.YOUTUBE_CLIENT_ID }}
          YOUTUBE_CLIENT_SECRET: ${{ secrets.YOUTUBE_CLIENT_SECRET }}
          YOUTUBE_REFRESH_TOKEN: ${{ secrets.YOUTUBE_REFRESH_TOKEN }}
        if: env.YOUTUBE_CLIENT_ID != '' && github.event.inputs.auto_upload != 'false'
        continue-on-error: true
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-backup-aquarius
          path: videos/youtube_shorts/Aquarius_*.mp4
          retention-days: 7
          if-no-files-found: warn
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-insta-aquarius
          path: videos/instagram_reels/Aquarius_*.mp4
          retention-days: 7
          if-no-files-found: warn

  pisces:
    needs: aquarius
    runs-on: ubuntu-latest
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      - run: sudo apt-get update && sudo apt-get install -y ffmpeg imagemagick && sudo sed -i '/<policy domain="path" rights="none" pattern="@\*"/d' /etc/ImageMagick-6/policy.xml
      - run: pip install -r requirements.txt
      - run: mkdir -p videos/youtube_shorts/ videos/instagram_reels/
      - run: python generate_short.py --sign "Pisces"
        env:
          HUGGINGFACE_API_KEY: ${{ secrets.HUGGINGFACE_API_KEY }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
      - run: sleep 90 && python upload_youtube.py --sign "Pisces" --shorts
        env:
          YOUTUBE_CLIENT_ID: ${{ secrets.YOUTUBE_CLIENT_ID }}
          YOUTUBE_CLIENT_SECRET: ${{ secrets.YOUTUBE_CLIENT_SECRET }}
          YOUTUBE_REFRESH_TOKEN: ${{ secrets.YOUTUBE_REFRESH_TOKEN }}
        if: env.YOUTUBE_CLIENT_ID != '' && github.event.inputs.auto_upload != 'false'
        continue-on-error: true
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-backup-pisces
          path: videos/youtube_shorts/Pisces_*.mp4
          retention-days: 7
          if-no-files-found: warn
      - uses: actions/upload-artifact@v4
        if: always()
        with:
          name: astrofinance-insta-pisces
          path: videos/instagram_reels/Pisces_*.mp4
          retention-days: 7
          if-no-files-found: warn
